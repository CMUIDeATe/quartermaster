<nav class="navbar navbar-default <%= "navbar-inverse" unless Rails.env.production? %>">
  <div class="container">

    <div class="navbar-header">
      <%= link_to root_path, class: "navbar-brand" do %>
        IDeATe Quartermaster
        <% if Rails.env.development? %>
          <div class="label label-warning">Dev</div>
        <% elsif Rails.env.staging? %>
          <div class="label label-info">Staging</div>
        <% end %>
      <% end %>
    </div>

    <ul class="nav navbar-nav">

      <% if can? :manage, :legacy_lending %>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown">
            Circulation <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <%= nav_link 'Lend', lending_lend_path %>
            <%= nav_link 'Return', lending_return_path %>
            <li role="separator" class="divider"></li>
            <%= nav_link 'Browse inventory', lending_browse_path %>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown">
            Sales <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">Sales</li>
            <%= nav_link 'Sell to IDeATe student', sales_student_path %>
            <%= nav_link 'Sell to course- or project-funded account', sales_course_path %>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Returns</li>
            <%= nav_link 'Return from IDeATe student', sales_student_return_path %>
            <%= nav_link 'Return from course- or project-funded account', sales_course_return_path %>
          </ul>
        </li>
      <% end %>

      <% if can? :read, :reservation %>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown">
            Reservations <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">Equipment</li>
            <%= nav_link 'VR Equipment', reservations_path(room: 'VR') %>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Classrooms</li>
            <%= nav_link 'Experimental Fabrication (A5)', reservations_path(room: 'A5') %>
            <%= nav_link 'Media Lab (A10A)', reservations_path(room: 'A10A') %>
            <%= nav_link 'Physical Computing (A10)', reservations_path(room: 'A10') %>
            <%= nav_link 'IDeATe Studios (106B/106C)', reservations_path(room: '106B') %>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Shop</li>
            <%= nav_link 'Wood Shop (A30/A31)', reservations_path(room: 'A30') %>
          </ul>
        </li>
      <% end %>

      <% if can? :read, :lending_schedule %>
        <%= nav_link 'Shift schedule', lending_schedule_path %>
      <% end %>

      <% if can? :manage, :legacy_lending %>
        <%= nav_link 'NVBots live feed', lending_nvbots_path %>
      <% end %>

      <% if user_signed_in? and current_user.has_role? :superadmin %>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          Development
          <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <% if can? :read, Item %>
            <li>
              <%= link_to 'Items', items_path %>
            </li>
            <% end %>
            <% if can? :read, PrintRequest %>
            <li>
              <%= link_to 'Print', print_requests_path %>
            </li>
            <% end %>
          </ul>
        </li>
      <% end %>

    </ul>


    <ul class="nav navbar-nav navbar-right">
      <% if user_signed_in? %>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          <%= image_tag current_user.gravatar_url, alt: '', role: 'icon' %>
          <%= current_user.andrewid %>
          <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li>
              <%= link_to destroy_user_session_path, :method => 'delete', :id => 'log_out' do %>
                <span class="glyphicon glyphicon-log-out"></span> Logout
              <% end %>
            </li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header"><%= app_version %></li>
          </ul>
        </li>
      <% else %>
        <li>
          <% if ENV['RAILS_ENV'] == 'development' %>
            <%= link_to new_user_session_path, :id => 'log_in' do %>
              <span class="glyphicon glyphicon-log-in"></span> Login
            <% end %>
          <% else %>
            <%= link_to user_shibboleth_omniauth_authorize_path, :id => 'log_in' do %>
              <span class="glyphicon glyphicon-log-in"></span> Login
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ul>

  </div>
</nav>
